"use strict";var SUBSTRING_OFFSET=15,MAX_KEYWORDS=30,MAX_DISPLAY_SLICES=5;function findKeywords(e,t){for(var n=0;n<e.length;++n){for(var r=t.dataContent.toLowerCase().indexOf(e[n].toLowerCase());0<=r;)t.matchedContentKeywords.push({keyword:t.dataContent.substring(r,r+e[n].length),index:r}),r=t.dataContent.toLowerCase().indexOf(e[n].toLowerCase(),r+e[n].length);for(var o=t.dataTitle.toLowerCase().indexOf(e[n].toLowerCase());0<=o;)t.matchedTitleKeywords.push({keyword:t.dataTitle.substring(o,o+e[n].length),index:o}),o=t.dataTitle.toLowerCase().indexOf(e[n].toLowerCase(),o+e[n].length)}}function buildSortedMatchedDataProps(e,t){for(var n=[],r=0;r<e.length;++r){var o={matchedContentKeywords:[],matchedTitleKeywords:[],dataTitle:e[r].title.trim(),dataContent:e[r].content.trim().replace(/<[^>]+>/g,""),dataURL:e[r].url};0<o.dataTitle.length+o.dataContent.length&&findKeywords(t,o),0<o.matchedContentKeywords.length+o.matchedTitleKeywords.length&&n.push(o)}return n.sort(function(e,t){return-(e.matchedContentKeywords.length+e.matchedTitleKeywords.length-(t.matchedContentKeywords.length+t.matchedTitleKeywords.length))}),n}function buildSortedSliceArray(e){var t=[];e.matchedContentKeywords.sort(function(e,t){return e.index-t.index});for(var n=0;n<e.matchedContentKeywords.length&&n<MAX_DISPLAY_SLICES;++n){var r=e.matchedContentKeywords[n].index-SUBSTRING_OFFSET,o=e.matchedContentKeywords[n].index+e.matchedContentKeywords[n].keyword.length+SUBSTRING_OFFSET;r<0&&(r=0),0===r&&(o=SUBSTRING_OFFSET+e.matchedContentKeywords[n].keyword.length+SUBSTRING_OFFSET),o>e.dataContent.length&&(o=e.dataContent.length),t.push({start:r,end:o})}return t}function mergeSliceArray(e){var t=[];if(0===e.length)return t;t.push(e[0]);for(var n=1;n<e.length;++n)t[t.length-1].end>=e[n].start?e[n].end>t[t.length-1].end&&(t[t.length-1].end=e[n].end):t.push(e[n]);return t}function buildHighlightedTitle(e){for(var t=e.dataTitle,n=[],r=0;r<e.matchedTitleKeywords.length;++r)0<e.matchedTitleKeywords[r].keyword.length&&n.push(e.matchedTitleKeywords[r].keyword);var o=new RegExp(n.join("|"),"gi");return t=t.replace(o,'<strong class="search-keyword">$&</strong>')}function buildHighlightedContent(e,t){for(var n=[],r=0;r<t.length;++r)n.push(e.dataContent.substring(t[r].start,t[r].end));var o=[];for(r=0;r<e.matchedContentKeywords.length;++r)0<e.matchedContentKeywords[r].keyword.length&&o.push(e.matchedContentKeywords[r].keyword);var a=new RegExp(o.join("|"),"gi");for(r=0;r<n.length;r++)n[r]=n[r].replace(a,'<strong class="search-keyword">$&</strong>');return n.join("...")}function onInput(e,t,n){if(t.innerHTML="",!(e.value.trim().length<=0)){var r=e.value.trim().split(/[\s-\+]+/),o=[];r.length>MAX_KEYWORDS&&(r=r.slice(0,MAX_KEYWORDS));var a=buildSortedMatchedDataProps(n,r);if(0!==a.length){o.push('<ul class="search-result-list">');for(var d=0;d<a.length;++d){o.push('<li><a href="'),o.push(a[d].dataURL),o.push('" class="search-result-title">'),o.push(buildHighlightedTitle(a[d])),o.push("</a>"),o.push('<p class="search-result-content">...');var s=mergeSliceArray(buildSortedSliceArray(a[d]));o.push(buildHighlightedContent(a[d],s)),o.push("...</p>")}o.push("</ul>"),t.innerHTML=o.join("")}}}function ajax(e,t){var n=null;window.XMLHttpRequest?n=new XMLHttpRequest:window.ActiveXObject&&(n=new ActiveXObject("Microsoft.XMLHTTP")),null!=n?(n.onreadystatechange=function(){4===n.readyState&&(200===n.status?t(n):console.error("XMLHttpRequest failed!"))},n.open("GET",e,!0),n.send(null)):console.error("Your broswer does not support XMLHttpRequest!")}var searchFunc=function(e,s,l){ajax(e,function(e){var t=[];if(e.responseXML)for(var n=e.responseXML.getElementsByTagName("entry"),r=0;r<n.length;r++)t.push({title:n[r].getElementsByTagName("title")[0].innerHTML||"",content:n[r].getElementsByTagName("content")[0].innerHTML||"",url:n[r].getElementsByTagName("url")[0].innerHTML||""});else{var o=JSON.parse(e.response);for(r=0;r<o.length;r++)t.push({title:o[r].title||"",content:o[r].content||"",url:o[r].url||""})}var a=document.getElementById(s),d=document.getElementById(l);a.addEventListener("input",function(){onInput(a,d,t)})})};