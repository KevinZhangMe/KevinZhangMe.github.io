"use strict";var type,username,repo,client_id,client_secret,no_comment,go_to_comment,btn_class,comments_target,recent_comments_target,loading_target,github_addr="https://github.com/",github_api_addr="https://api.github.com/repos/",oschina_addr="http://git.oschina.net/",oschina_api_addr="http://git.oschina.net/api/v5/repos/",spinOpts={lines:13,length:10,width:6,radius:12,corners:1,rotate:0,direction:1,color:"#5882FA",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"50%"},_getComment=function t(n,i){var e,s=void 0,a=void 0;s=n.comments,e=n.comments_url,a=n.page,$.ajax({url:e+"?page="+a,dataType:"json",cache:!1,crossDomain:!0,data:client_id&&client_secret?"client_id="+client_id+"&client_secret="+client_secret:"",success:function(e){if(!e||e.length<=0)return i&&"function"==typeof i&&i(s),void(i=null);e.forEach(function(e){s.push(e)}),a+=1,n.comments=s,n.page=a,t(n,i)},error:function(e){i&&"function"==typeof i&&i(s),i=null}})},_getCommentsUrl=function t(n,i){var s,a=void 0,o=!1;s=n.issue_title,a=n.page;var e="github"==type?github_api_addr:oschina_api_addr;$.ajax({url:e+username+"/"+repo+"/issues?page="+a,dataType:"json",cache:!1,crossDomain:!0,data:client_id&&client_secret?"client_id="+client_id+"&client_secret="+client_secret:"",success:function(e){if(!e||e.length<=0)return i&&"function"==typeof i&&i("",""),void(i=null);e.forEach(function(e){e.title&&e.title==s&&(i&&"function"==typeof i&&i(e.comments_url,e),o=!0,i=null)}),o||(a+=1,n.page=a,t(n,i))},error:function(){i&&"function"==typeof i&&i("",""),i=null}})},_getIssue=function(e,t){_getIssueByUrl(("github"==type?github_api_addr:oschina_api_addr)+username+"/"+repo+"/issues/"+e,function(e){t&&"function"==typeof t&&t(e),t=null})},_getIssueByUrl=function(e,t){$.ajax({url:e,dataType:"json",cache:!1,crossDomain:!0,data:client_id&&client_secret?"client_id="+client_id+"&client_secret="+client_secret:"",success:function(e){if(!e||e.length<=0)return t&&"function"==typeof t&&t(),void(t=null);t&&"function"==typeof t&&t(e),t=null},error:function(){t&&"function"==typeof t&&t(),t=null}})},_renderComment=function(e){var t=timeago(),n=e.user,i=marked(e.body),s=t.format(e.created_at),a=n.login==username?"current-user":"",o="github"==type?github_addr:oschina_addr,c=n.login==username?'\n        <span class="timeline-comment-label text-bold tooltipped tooltipped-multiline tooltipped-s" aria-label="'+username+' is the author of this blog.">\n        Owner\n    </span>\n        ':"";return'\n        <div class="timeline-comment-wrapper js-comment-container">\n        <div class="avatar-parent-child timeline-comment-avatar">\n        <a href="'+o+n.login+'">\n        <img alt="@'+n.login+'" class="avatar rounded-1" height="44" src="'+n.avatar_url+'&amp;s=88" width="44">\n        </a>\n        </div>\n        <div id="issuecomment-310820108" class="comment previewable-edit js-comment js-task-list-container  timeline-comment js-reorderable-task-lists reorderable-task-lists '+a+'" data-body-version="0ff4a390ed2be378bf5044aa6dc1510b">\n\n        <div class="timeline-comment-header">\n        '+c+'\n        <h3 class="timeline-comment-header-text f5 text-normal">\n\n        <strong>\n        <a href="'+o+n.login+'" class="author">'+n.login+'</a>\n        \n    </strong>\n\n    commented  \n\n        <a href="#issuecomment-'+e.id+'" class="timestamp"><relative-time datetime="'+e.created_at+'" title="'+e.created_at+'">'+s+'</relative-time></a>\n\n    </h3>\n        </div>\n        \n        <table class="d-block">\n        <tbody class="d-block">\n        <tr class="d-block">\n        <td class="d-block comment-body markdown-body js-comment-body">\n        '+i+"\n    </td>\n        </tr>\n        </tbody>\n        </table>\n        </div>\n        </div>\n        "},_renderRecentComment=function(e,t,n,i,s,a){var o="github"==type?github_addr:oschina_addr,c='\n        <div class="comment-item">\n          <div class="row comment-widget-head">\n            <div class="xl-col-3 comment-widget-avatar">\n              <a href="'+o+e.login+'">\n                <img alt="@'+e.login+'" class="avatar rounded-1" height="44" src="'+e.avatar_url+'&amp;s=88" width="44">\n              </a>\n            </div>\n            <div class="comment-widget-body">\n              <span><a class="comment-widget-user" href="'+o+e.login+'" target="_blank">'+e.login+'</a> </span>\n              <div class="comment-widget-content">'+n+'</div>\n            </div>\n          </div>\n          <br/>\n          <div class="comment-widget-meta">\n            <span class="comment-widget-title">'+t+'</span> | <span class="comment-widget-date">'+i+"</span>\n          </div>\n        </div>\n        ";a&&"function"==typeof a&&a(c),a=null},_getRecentCommentList=function t(n,i,s,a,o,c){if(a<=s||i>=o.length)return c&&"function"==typeof c&&c(n),void(c=null);var e=o[i];if(e){var r=marked(e.body),d=e.title,l=e.user,m=timeago().format(e.created_at),u=e.html_url;if(!r||""==r)return t(n,++i,s,a,o,c),void(c=null);d?_renderRecentComment(l,d,r,m,u,function(e){t(n+=e,++i,++s,a,o,c)}):_getIssueByUrl(e.issue_url,function(e){_renderRecentComment(l,e.title,r,m,u,function(e){t(n+=e,++i,++s,a,o,c)})})}},_renderRecentCommentList=function(e,t){_getRecentCommentList("",0,0,t,e,function(e){$(recent_comments_target).append(e)})},_renderHTML=function(e){var t,n,i=void 0,s=void 0;t=e.issue,i=e.comments,s=e.comments_url,n=e.issue_title;var a="github"==type?github_addr:oschina_addr,o="github"==type?github_api_addr:oschina_api_addr,c='\n        <div class="discussion-item discussion-item-labeled">\n        <h3 class="discussion-item-header f5 text-normal" id="event-1157063333">\n\n        <span class="discussion-item-icon">\n        <svg aria-hidden="true" class="octicon octicon-tag" height="16" version="1.1" viewBox="0 0 16 16" width="14"><path fill-rule="evenodd" d="M15 1H6c-.55 0-1 .45-1 1v2H1c-.55 0-1 .45-1 1v6c0 .55.45 1 1 1h1v3l3-3h4c.55 0 1-.45 1-1V9h1l3 3V9h1c.55 0 1-.45 1-1V2c0-.55-.45-1-1-1zM9 11H4.5L3 12.5V11H1V5h4v3c0 .55.45 1 1 1h3v2zm6-3h-2v1.5L11.5 8H6V2h9v6z"></path></svg>\n        </span>\n        The above comments are provided by \n        <a href="http://github.com/wzpan/comment.js" class="discussion-item-entity" target="_blank">comment.js</a> with the help of '+("oschina"==type?'<a href="http://oschina.net" class="discussion-item-entity" target="_blank">OSChina issue</a>':'<a href="http://github.com" class="discussion-item-entity" target="_blank">Github issue</a>')+".\n        </h3>\n        </div>\n        ";if(t&&t.body&&""!=t.body||i&&!(i.length<=0)){var r='\n            <div class="discussion-timeline js-quote-selection-container">\n            <div class="js-discussion js-socket-channel">\n            ';t&&t.body&&""!=t.body&&(r+=_renderComment(t)),i.forEach(function(e){r+=_renderComment(e)}),r+=c,r+="</div></div>",$(comments_target).append(r)}else{var d="\n            <div class='js-discussion no-comment'>\n            <span>"+no_comment+"</span>\n            </div>\n            ";$(comments_target).append(d)}var l='\n        <p class="goto-comment">\n        <a href="'+(s?s.replace(o,a).replace("comments","")+"#new_comment_field":a+"/"+username+"/"+repo+"/issues/new?title="+n+"#issue_body")+'" class="'+btn_class+'" target="_blank">'+go_to_comment+"</a>\n        </p>\n        ";$(comments_target).append(l)},CompareDate=function(e,t){var n=e.created_at.replace("T"," ").replace("Z","").replace(/-/g,"/"),i=t.created_at.replace("T"," ").replace("Z","").replace(/-/g,"/");return new Date(n)>new Date(i)},_getRecentIssues=function(e,t){var n;n=e.count;var i="github"==type?github_api_addr:oschina_api_addr;$.ajax({url:i+username+"/"+repo+"/issues?per_page=100&sort=created&direction=desc",dataType:"json",cache:!1,crossDomain:!0,data:client_id&&client_secret?"client_id="+client_id+"&client_secret="+client_secret:"",success:function(e){e.length>n&&(e=-1!=navigator.userAgent.indexOf("MSIE")||-1!=navigator.userAgent.indexOf("Edge")||1==!!document.documentMode?e.sort(CompareDate).slice(0,5):e.sort(CompareDate).reverse().slice(0,5)),t&&"function"==typeof t&&t(e),t=null},error:function(e){t&&"function"==typeof t&&t(),t=null}})},_getRecentComments=function(e,t){var n;n=e.count;var i="github"==type?github_api_addr:oschina_api_addr;$.ajax({url:i+username+"/"+repo+"/issues/comments?per_page=100&sort=created&direction=desc",dataType:"json",cache:!1,crossDomain:!0,data:client_id&&client_secret?"client_id="+client_id+"&client_secret="+client_secret:"",success:function(e){e.length>n&&(e=-1!=navigator.userAgent.indexOf("MSIE")||-1!=navigator.userAgent.indexOf("Edge")||1==!!document.documentMode?e.sort(CompareDate).slice(0,5):e.sort(CompareDate).reverse().slice(0,5)),t&&"function"==typeof t&&t(e),t=null},error:function(e){t&&"function"==typeof t&&t(),t=null}})},getRecentCommentsList=function(t){var n,e;type=t.type,e=t.user,repo=t.repo,client_id=t.client_id,client_secret=t.client_secret,n=t.count,recent_comments_target=t.recent_comments_target,username=e,recent_comments_target=recent_comments_target||"#recent-comments";var i=new Array;_getRecentIssues(t,function(e){i=i.concat(e),_getRecentComments(t,function(e){i=i.concat(e),i=-1!=navigator.userAgent.indexOf("MSIE")||-1!=navigator.userAgent.indexOf("Edge")||1==!!document.documentMode?i.sort(CompareDate):i.sort(CompareDate).reverse(),_renderRecentCommentList(i,n)})})},getComments=function(e){var i,t,n;if(type=e.type,n=e.user,repo=e.repo,client_id=e.client_id,client_secret=e.client_secret,no_comment=e.no_comment,go_to_comment=e.go_to_comment,i=e.issue_title,t=e.issue_id,btn_class=e.btn_class,comments_target=e.comments_target,loading_target=e.loading_target,comments_target=comments_target||"#comment-thread",username=n,loading_target)var s=new Spinner(spinOpts);timeago();var a=new Array;if(type=type||"github",btn_class=btn_class||"btn",loading_target&&s.spin($("div"+loading_target).get(0)),t&&"undefined"!=t&&void 0!==t){var o=("github"==type?github_api_addr:oschina_api_addr)+username+"/"+repo+"/issues/"+t+"/comments";_getIssue(t,function(t){_getComment({comments:a,comments_url:o,page:1},function(e){loading_target&&s.spin(),_renderHTML({issue:t,comments:e,comments_url:o,issue_title:i}),loading_target&&s.spin()})})}else _getCommentsUrl({issue_title:i,page:1},function(t,n){if(""==t||null==t)return loading_target&&s.spin(),void _renderHTML({issue:n,comments:a,comments_url:t,issue_title:i});_getComment({comments:a,comments_url:t,page:1},function(e){loading_target&&s.spin(),_renderHTML({issue:n,comments:e,comments_url:t,issue_title:i})})})};